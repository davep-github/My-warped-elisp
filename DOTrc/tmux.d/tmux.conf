# Change the prefix key to C-x
set -g prefix C-x
unbind C-b
# hello, screen
bind C-x send-prefix
set -g mode-keys emacs
set -s command-alias lss=list-sessions

# <snatch>
#
# Example .tmux.conf
#
# By Nicholas Marriott. Public domain.
#

# Some tweaks to the status line
# meh, there's plenty'o'space.
#set -g status-right "%H:%M"
set -g window-status-current-style "bold"

# If running inside tmux ($TMUX is set), then change the status line to red
%if #{TMUX}
set -g status-bg red
%endif

# Enable RGB colour if running in xterm(1)
set-option -sa terminal-overrides ",xterm*:Tc"

# Change the default $TERM to tmux-256color
set -g default-terminal "tmux-256color"

# No bells at all
set -g bell-action none

# Keep windows around after they exit
set -g remain-on-exit on

# Turn the mouse on, but without copy mode dragging
set -g mouse on
#bind -n MouseDrag1Pane
#bind -Tcopy-mode MouseDrag1Pane
set -g set-clipboard external
bind-key	-T root		MouseUp2Pane	paste


# # TEST of "pseudo-macro"
bind-key M-m source-file ~/.tmax.d/tmax-example.tmax
# # Clunky at best.
bind-key M-q source-file ~/.tmax.d/tmax-example.tmax

########################################################################
# Sel/copy/paste.
# You'd think this'd be pretty popular, with a few variants.
# 
set-option default-terminal tmux

# remap prefix to Control + a

#later bind-key -n 'M-Left' select-pane -L
#later bind-key -n 'M-Down' select-pane -D
#later bind-key -n 'M-Up' select-pane -U
#later bind-key -n 'M-Right' select-pane -R

# Linux only
set -g mouse on
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" \
     		    "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M
########################################################################


# A key to toggle between smallest and largest sizes if a window is visible in
# multiple places
bind F set -w window-size

# Keys to toggle monitoring activity in a window and the synchronize-panes option
bind m set monitor-activity
bind y set synchronize-panes\; display 'synchronize-panes #{?synchronize-panes,on,off}'

# Wish there were a way to clone or share or alias bindings.
# E.g. bind-key alias n --> C-n, so C-x C-n (as per screen and the Emacs
# way-ish.)
# Why bother remembering new shit when I can dupe existing screen, vim, *My* Emacs shit.
bind-key    -T prefix       C-b                   copy-mode
# Default is copy-mode -eu, but exiting copy-mode @ bottom is annoying.
bind-key    -T prefix       PPage                 copy-mode -u
bind-key    -T root	    S-PPage		  copy-mode -u
bind-key    -T copy-mode    S-NPage               send-keys -X page-down
bind-key    -T copy-mode    S-PPage               send-keys -X page-up

bind-key    -T prefix       M-y                   paste-buffer
bind-key    -T prefix       C-c                   new-window
bind-key    -T prefix       C-d                   detach-client
bind-key    -T prefix       C-n                   next-window
bind-key    -T prefix       C-p                   previous-window
bind-key    -T prefix       C-l                   refresh-client
bind-key    -T prefix       \~                    show-messages
# / --> mnemonic for over?
bind-key    -T prefix       /                     split-window
# More side-by-sidish.
bind-key    -T prefix       |                     split-window -h
bind-key    -T prefix	    R			  display-message "sourcing config" \; \
	       		    			  source-file ~/.tmux.conf \;  \
						  display-message "source-file done"

## NB: Be careful.  We don't want to usurp an interior spp's keys.
# embiggen/warm-water, emscrinken/cold-water
bind-key -r -T root         M-Up                  select-pane -t :.+
bind-key -r -T root         M-Down                select-pane -t :.-
bind-key -T root       	    M-x			  command-prompt

bind-key    -T copy-mode    M-a                   send-keys -X begin-selection
# god damn mother fucking universe.  Or me.  But, C-[PN]Page don't work.
bind-key    -T copy-mode    M-PPage		  send-keys -X history-top
bind-key    -T copy-mode    M-NPage		  send-keys -X history-bottom
#won't bind bind-key    -T copy-mode    C-PPage		  send-keys -X history-top
#won't bind bind-key    -T copy-mode    C-NPage		  send-keys -X history-bottom
bind-key    -T copy-mode    M-o                   send-keys -X copy-selection-and-cancel

set -s command-alias lsb=list-buffers
set -s command-alias lsblk=list-blocks
set -s command-alias lsc=list-clients
set -s command-alias lscmd=list-commands
set -s command-alias lsk=list-keys
set -s command-alias lsp=list-panes
set -s command-alias lsr=list-regs
# The name lss *used* to work.  No changes to the system I could see.  I
# installed from sources and still have the problem.  In fact a variety of
# names don't work, but I've not found a rhyme or reason.
#################set -s command-alias lss=list-sessions
# Checking to see if lss was the problem.  Nope, bubba don't work neither.
set -s command-alias bubba=list-sessions
set -s command-alias lsw=list-windows
set -s command-alias exit=kill-session
set -s command-alias sconf='source-file ~/.tmux.conf'
set -s command-alias reconf='source-file ~/.tmux.conf'
set -s command-alias rc='source-file ~/.tmux.conf'
set -s command-alias cbc='source-file ~/.tmax.d/copy-buffer-to-clipboard.tmax'


bind-key    -T prefix       M-o		cbc

# @todo XXX Change tmux bindings C-x <char> to all of my muscularly memorialzed
# screen
# So much quicker to not lift yo' lil' finger off the Ctl key.
# Don't wanna blister on your little finger.  Or your thumb.

# copy-mode: bind ^B ^[ [
#somthing here running xem? # should be started with "tmux attach" rather than "tmux new"
#somthing here running xem? new -d -s0 -nirssi 'exec irssi'
#somthing here running xem? set -t0:0 monitor-activity on
#somthing here running xem? set  -t0:0 aggressive-resize on
#somthing here running xem? neww -d -ntodo 'exec emacs ~/TODO'
#somthing here running xem? setw -t0:1 aggressive-resize on
#somthing here running xem? neww -d -nmutt 'exec mutt'
#somthing here running xem? setw -t0:2 aggressive-resize on
#somthing here running xem? neww -d
#somthing here running xem? neww -d
#somthing here running xem? neww -d

