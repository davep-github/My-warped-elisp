#!/bin/sh

source script-x
set -u
progname="$(basename $0)"
source eexec
eexec_program=$(EExec_parse "$@")
for op in $eexec_program
do
  $op
  shift
done
unset eexec_program

# ec [-w] first second

wait_opt=-w

while (($# > 0))
do
  case "$1" in
      -w|--no-wait) wait_opt=;;
      -u) ;; # This is often left over from a regular diff command. Ignore it.
      *) break;;
  esac
  shift
done

fileA=$(realpath "${1}")
file2=$(realpath "${2}")
diff_cmd="(ediff-files \"$fileA\" \"$file2\")"

# Fix this to use some kind of ipc so the wait actually works.
#
# touch wait file.
# dp-ediff-files removes file when diff session ends?
EExec ec ${wait_opt} -e "${diff_cmd}"
# wait for file to disappear.
