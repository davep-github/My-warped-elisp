#!/bin/bash
# I'm sure this exists somehow, somewhere.

source script-x
set -u

[ "$*" = "" ] && {
    echo "Usage: $(basename $0) nth files..."
    exit 1
} 1>&2

: ${base_rev=HEAD}
: ${diff_tool=}

export base_rev

nth=${1-}
shift

if [ "$nth" = 1 ]
then
    th="st"
else
    if [ "$nth" = 2 ]
    then
        th="nd"
    else
        th="th"
    fi
fi
for file in "$@"
do
  rev=$(git-nth-rev "$nth" "$file")
  if [ -z "$rev" ]
  then
      echo "$file has no ${nth}${th} previous rev."
      continue
  fi 1>&2

  if vsetp "${diff_tool}"
  then
      git difftool --tool="${difftool}" "$rev" "$file"
  else
      git diff "$rev" "$file"
  fi
done
