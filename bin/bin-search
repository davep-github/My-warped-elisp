#!/bin/bash

source script-x
set -u
progname="$(basename $0)"
source eexec
eexec_program=$(EExec_parse "$@")
for op in $eexec_program
do
  $op
  shift
done
unset eexec_program

[[ "${1-}" = --help ]] && {
    echo "usage: bin-search <glob>
Search all bin dirs in \$PATH for <glob>.
"
    exit 0
}

function list_files_by_glob() {
    local bin="${1}"; shift
    local glob="${1}"
    ls -1 "${bin}/${glob}"
}

function list_files_by_regexp() {
    local bin="${1}"; shift
    local regexp="${1}"; shift
    ls -1 "${bin}/" | "${GREPPER}" -e "${regexp}"
}

[[ -z "$*" ]] && {
    echo "A pattern is needed."
    exit 1
} 1>&2

true ${GREPPER:="egrep"}	# Keyword arguments ;->

true "${use_regexp_p:=}"

# @todo XXX Crap code is OK until more options are needed.
if [[ "${1-}" == -r ]]
then
    philtre=list_files_by_regexp
    shift
else
    philtre=list_files_by_glob
fi

pattern="${1}"
spaced_path=$(echo "${PATH}" | sed -r 's/:/ /g')
for bin in ${spaced_path}
do
    echo "${philtre}" "${bin}" "${pattern}" "|" "${philtre}"
    "${philtre}" "${bin}" "${pattern}" | "${philtre}" | read
    {
	candidate="${REPLY}"
	echo -n "${candidate}"
        EExec_verbose_msg "candidate>${candidate}<"
        [[ -x "${candidate}" ]] || {
            echo -n ":not executable"
        }
	echo 
    }
done

