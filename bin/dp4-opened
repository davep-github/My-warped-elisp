#!/bin/sh

export DP_SCRIPT_X_DASH_X_STR=-SCRIPT_X

source script-x
set -u
progname="$(basename $0)"
source eexec
eexec_program=$(EExec_parse "$@")
for op in $eexec_program
do
  $op
  shift
done
unset eexec_program

reroot()
{
    dp4-reroot .
}

extract()
{
    dp4-extract-pathname
}

sans_junk()
{
    dp4-sans-junk
}

: ${rerooter=cat}

stdin_p=

one="${1-}"

case "${one}" in
    -r) shift; rerooter=reroot;;
    --sans-junk) rerooter=sans_junk;;
    -e|-x) shift; rerooter=extract;;
    --stdin) stdin_p=t;;
    *) ;;
esac

if vsetp "${stdin_p}"
then
    cat
else
    p4 opened "$@" 
fi | $rerooter

