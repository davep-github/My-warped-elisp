#!/bin/sh

source script-x
set -u
progname="$(basename $0)"
source eexec
eexec_program=$(EExec_parse "$@")
for op in $eexec_program
do
  $op
  shift
done
unset eexec_program

: ${filter_regexp:=' o_pri_interactive '}

[ -z "$*" ] && {
    set -- '.*'
}

filter_regexp="JOBID|${filter_regexp}"

jids=$(bjobs -w \
     | egrep -v "${filter_regexp}" 2>/dev/null \
     | awk '{print $1}' \
     | sort \
     | uniq \
     | egrep "$@")

if [ -n "${jids}" ]
then
    EExec_verbose_msg "Jobs:
$(bjobs ${jids})"
    EExec bkill ${jids}
else
    EExec_verbose_msg "No jids."
fi
