#!/bin/sh

source script-x
set -u

: ${max_count:=1}
: ${base_rev:=HEAD}

nth="$1"
case "$1" in
    -[0-9]*) nth=$(echo "$1" | sed -rn 's/^(-)([0-9]*)/\2/p');;
    -n) shift; nth="${1}";;
    -n[0-9]*) nth=$(echo "$1" | sed -rn 's/^(-n)([0-9]*)/\2/p');;
    -|=|.) ;;
    *) base_rev="${1}";
esac
shift;
file="$1"
shift;

if (($# > 0))
then
    echo "1>$1<"
    shift; 
    if (($# > 0))
    then
        max_count="${1}"
    fi
fi

git rev-list --max-count=${max_count} --skip="$nth" "$base_rev" "$file"
